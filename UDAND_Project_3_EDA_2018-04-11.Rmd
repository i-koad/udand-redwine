---
title: "Chemical Properties Influencing Red Wine Quality"
subtitle: A Project for Exploratory Data Analysis with R
---
```{r echo=FALSE}
# Change echo to FALSE when knitting to HTML for submmission.
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```

## Introduction
This report explores various chemical properties that could influence red 
wine's quality.

The data set is sourced from:

P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.  
Modeling wine preferences by data mining from physicochemical properties.  
In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.  

Available at:  
[@Elsevier] http://dx.doi.org/10.1016/j.dss.2009.05.016  
[Pre-press (pdf)] http://www3.dsi.uminho.pt/pcortez/winequality09.pdf  
[bib] http://www3.dsi.uminho.pt/pcortez/dss09.bib

### Overview of Data Set
```{r Packages, echo=FALSE, message=FALSE, warning=FALSE,}
library(ggplot2)
library(dplyr)
library(GGally)
library(reshape2)
library(gridExtra)
library(scales)

```

```{r Load the data, echo=FALSE}
setwd("~/UDAND/Proj 3_EDA/")
wine <- read.csv("wineQualityReds.csv")

str(wine)
```


```{r}
summary(wine)
```

The dataset contains 1,599 entries of red wine, each with 12 
variables comprising 11 measured chemical properties and 1 subjective grading 
of the wine's quality.

***

## Univariate Plots
### Histogram of Quality

```{r Histogram of quality}
ggplot(data = wine, aes(quality)) + 
  geom_bar() + 
  scale_x_continuous(breaks = seq(1, 8, 1)) + 
  scale_y_continuous(breaks = seq(0, 700, 100))

```

**Observation(s):**

1. Many of the wines were rated with quality levels 5 & 6.

2. The note accompanying the data set suggests that "there are much more 
normal wines than excellent or poor ones".

3. Thus, wine quality in the data set can be grouped into a broader 
segregation of poor [3 - 4], normal [5 - 6], excellent [> 7]. This 
segregration will be helpful in visualizing the influence of other variables 
on the quality.

***

### Grouping of Quality Scores

```{r}
# Create a new variable in data frame containing the 3 classification 
# for quality levels "Poor", "Normal", "Excellent"
wine$grade <- cut(wine$quality, breaks = c(3, 4, 6, 8), 
                          include.lowest = T, right = T, 
                          labels = c("Poor", "Normal", "Excellent"))
# Check new variable
#str(wine$grade)
#levels(wine$grade)
#head(subset(wine, grade == "Excellent" & quality == 8)[, 13:14])

# Histogram with new variable
ggplot(data = wine, aes(grade)) + 
  geom_bar() + 
  scale_y_continuous(breaks = seq(0, 1500, 200))

```

```{r}
wine %>% 
  group_by(grade) %>% 
  summarize(
    n = n(), 
    percentage = percent(n() / 1599)
    )
```


**Observation(s):**  
The red wine dataset is heavily represented by Normal grade quality score, 
with over 82% of wines being scored as such. 

***

```{r Function to output histogram plots}
#' Plot histogram using hardcoded colours for fill and line of bars.
#' 
#' @param df Dataframe. For use as data source to ggplot(). 
#' @param x_var String. Variable a.k.a column name in data frame for x-axis in 
#'    histogram.
#' @param binw Integer. Variable to effect binwidth of histogram. Defaults to 
#'    NULL.
#' @param x_scale Vector of type "integer" or "double". Generated by function 
#'    _seq_ to used to effect breaks on x-axis. 
#'
#' @return None.
#'
#' @examples
#' plot_custom_histo(wine, "fixed.acidity")
#' plot_custom_histo(wine, "fixed.acidity", 1)
#' plot_custom_histo(wine, "fixed.acidity", 1, seq(4, 16, 2))
plot_custom_histo <- function(df, x_var, binw = NULL, x_scale = NULL) {
  p <- ggplot(data = df, aes_(as.name(x_var))
              ) +
       geom_histogram(binwidth = binw)
  
  if(is.vector(x_scale)) {
    p <- p + scale_x_continuous(breaks = x_scale)
  }
  
  p
}

```


```{r Function to boxplot on quality}
#' Plot boxplot on "quality" using hardcoded colours for fill and line of bars.
#' Factors built-in variable "quality" to be used in x-axis.
#' 
#' @param df Dataframe. For use as data source to ggplot(). 
#' @param y_var String. Variable a.k.a column name in data frame for y-axis.
#' @param y_scale Vector of type "integer" or "double". Generated by function 
#'    _seq_ to used to effect breaks on y-axis.
#' @param on_grade Logical. 
#'    If TRUE, boxplot is made using variable "grade" cut from "quality".
#'    If FALSE, boxplot is made using variable "quality" 
#'
#' @return None.
#'
#' @examples
#' boxplot_on_quality(wine, "alcohol")
#' boxplot_on_quality(wine, "alcohol", seq(0, 16, 2))
#' boxplot_on_quality(wine, "alcohol", seq(0, 16, 2), on_grade = T)
boxplot_on_quality <- function(df, y_var, y_scale = NULL, on_grade = FALSE) {
  if(on_grade) {
    p <- ggplot(data = df, aes_(x = as.name("grade"), 
                                y = as.name(y_var)
                                )
                )
  }
  else {
    df$quality.factor <- factor(df$quality, ordered = T)
    p <- ggplot(data = df, aes_(x = as.name("quality.factor"),
                              y = as.name(y_var)
                              )
                )
  }

  p <- p + geom_boxplot()

  if(is.vector(y_scale)) {
    p <- p + scale_y_continuous(breaks = y_scale)
  }

  p
}

```


### Fixed Acidity

```{r Histogram of fixed acidity}
plot_custom_histo(wine, "fixed.acidity", binw = 0.5)
```

**Observation(s):**  
Normal distribution with positive skew and possible outliers after "14" on 
x-axis. 

***

### Volatile Acidity

```{r Histogram of volatile acidity}
plot_custom_histo(wine, "volatile.acidity", binw = .05)
```

**Observation(s):**  
Normal distribution with positive skew and possible outliers after "1.1" 
on x-axis. 

***

### Citric Acid

```{r Histogram for citric acid}
plot_custom_histo(wine, "citric.acid", binw = .025) + 
  geom_vline(xintercept = median(wine$citric.acid), 
             color = "orange", 
             linetype = 2, 
             size = 1)

```

```{r Citric acid central tendency}
summary(wine$citric.acid)
```


**Observation(s):**  
Multi-modal distribution of samples across the range of citric acid. The  
dashed line represents the median value from the data set. It would be
interesting to observe how this property exhibits itself across the 
different quality grades.

***

### Residual sugar

```{r Histogram for residual sugar}
plot_custom_histo(wine, "residual.sugar", binw = 1/3, 
                  x_scale = seq(0, 10, 1)) + 
  coord_cartesian(xlim = c(0.5, quantile(wine$residual.sugar, probs = .99)))

```

**Observation(s):**  
Normal distribution that is positively skewed, and is a candidate for 
application of log transformation.

```{r Residual sugar with transformation, message=FALSE, warning=FALSE}
plot_custom_histo(wine, "residual.sugar", binw = 1/8) + 
  scale_x_continuous(trans = "log", 
                     limits = c(
                       1, 
                       quantile(wine$residual.sugar, probs = .99)
                       )
                     ) + 
  ggtitle("residual.sugar (log)")
```

**Observation(s):**  
A more normal distribution after log transformation.   

***

### Chlorides

```{r}
plot_custom_histo(wine, "chlorides", binw = .005, 
                  x_scale = seq(0, .7, .1)) + 
  coord_cartesian(xlim = c(0, quantile(wine$chlorides, probs = .99)))
  
```

**Observation(s):**  
Normal distribution that is postively skewed. Outliers filtered out by 
limiting plot to points with 99% quantile, yet long-tail still exists.  

```{r Histogram of free chlorides with transformation, message=FALSE}
plot_custom_histo(wine, "chlorides", binw = 0.05) +
  scale_x_continuous(trans = "log") + 
  coord_cartesian(xlim = c(.02, quantile(wine$chlorides, probs = .99))) +
  ggtitle("Histogram of Chlorides (log)")
```

**Observation(s):**  
Normal distribution with long tail after log transformation.

***

### Free SO2

```{r}
plot_custom_histo(wine, "free.sulfur.dioxide", binw = 2)
```

**Observation(s):**  
This positively skewed plot almost has a log normal distribution.

```{r Histogram of free SO2 with transformation, message=FALSE}
(h1 <- plot_custom_histo(wine, "free.sulfur.dioxide", binw = 0.5) +
  scale_x_continuous(trans = "sqrt") + 
  ggtitle("free.sulfur.dioxide (sqrt)"))
```

**Observation(s):**  
Transformed plot using square-root has a more normal distribution. 

```{r Cube-root transformation on free SO2, message=FALSE}

# Function for cube-root transformation.
cuberoot_trans = function() trans_new('cuberoot', 
                                      transform = function(x) x^(1/3),
                                      inverse = function(x) x^3)

# Plot with cube-root transformation
h2 <- plot_custom_histo(wine, "free.sulfur.dioxide", binw = 0.2) +
  scale_x_continuous(trans = cuberoot_trans()) + 
  ggtitle("free.sulfur.dioxide (cube-root)")

grid.arrange(h1, h2, nrow = 2)
```

**Observation(s):**  
Applying cube-root transformation did not improve the distribution. 

***

### Total SO2

```{r}
plot_custom_histo(wine, "total.sulfur.dioxide", binw = 5)
```

**Observation(s):**  
This positively skewed plot almost has a log normal distribution, and 
resembles the shape of plot for "free sulfur dioxide".

```{r Histogram of total SO2 with transformation, message=FALSE}
plot_custom_histo(wine, "total.sulfur.dioxide", binw = 0.15) +
  scale_x_continuous(trans = "log10") + 
  ggtitle("Histogram of total.sulfur.dioxide (log10)")
```

**Observation(s):**  
Transformed plot using log10 gives a normal distribution.

***

### Density

```{r Histogram for density}
plot_custom_histo(wine, "density", binw = 1/1000, 
                  x_scale = seq(.98, 1.005, 2/1000))

```

**Observation(s):**  
Normal distribution. 

***

### pH

```{r}
plot_custom_histo(wine, "pH", binw = .05)
```

**Observation(s):**  
Normal distribution. 

***

### Sulphates

```{r Histogram for sulphates}
plot_custom_histo(wine, "sulphates", binw = 1/16) + 
  coord_cartesian(xlim = c(0.25, quantile(wine$sulphates, probs = .99)))

```

**Observation(s):**  
This positively skewed plot almost has a log normal distribution, and 
long-tail spread (even after filtering data points beyond the 99% quantile). 

```{r Histogram of sulphates with transformation, message=FALSE, warning=FALSE}
plot_custom_histo(wine, "sulphates", binw = 0.1) +
  scale_x_continuous(trans = "log", 
                     limits = c(0.3, quantile(wine$sulphates, probs = .99)
                                )
                     ) + 
  ggtitle("Histogram of sulphates (log)")
```

**Observation(s):**  
Normal distribution after transforming with log and removing points beyond 
99% quantile.

***

### Alcohol

```{r Histogram for alcohol}
plot_custom_histo(wine, "alcohol", binw = 0.5, 
                  x_scale = seq(8, 15, 1))

```

**Observation(s):**  
Positively skewed normal distribution plot. 

***

## Univariate Analysis
### What is the structure of your dataset?
Dataset of red wine has 1,599 observations with 13 variables. 11 of those 
variables represent measured chemical properties in the wine, and 1 
represents subjective quality score given by wine experts. The remaining 
variable represents a numbering sequence for entries in the dataset.

### What is/are the main feature(s) of interest in your dataset?
Quality score and citric acid concentrtion are the main features of interest. 

The distribution of citric acid is multi-modal, and I'd like to see 
how this ties in with quality score. Citric acid concentration is said to 
give wine a fruity flavour. 


### What other features in the dataset do you think will help support your \
investigation into your feature(s) of interest?
I think alcohol and sulphates could contribute to the variation of quality. 


### Did you create any new variables from existing variables in the dataset?
I created a new variable called "grade" to represent the grouping of 
"quality" scores.

The quality score of wines in dataset range from 3 to 8. The distribution of 
quality scores suggest that wines can be broadly grouped into Poor, Normal, 
Excellent grades where:

1. Poor has quality score 3 - 4

2. Normal has quality score 5 - 6  

3. Excellent has quality socre 7 - 8

The revised grading can help enhance visualization with respect to wine 
quality by reducing information overload.


### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?
Yes, several properties had histograms that were skewed (positively), which 
benefitted from transformation and cut-off (at 99% quantile) to produce a more 
normal distribution.

Between histograms of all chemical properties, the "citric.acid" histogram 
must be the most unusual with its multi-modal distribution. 

Posts in [StackExchange](https://stats.stackexchange.com/questions/209241/what\
-transformation-should-i-use-for-a-bimodal-distribution) suggested that 
monotonic transformation may not be useful in this case.

***

## Bivariate Plots

Creating a scatter plot matrix with "grade" and omitting "quality" to catch a 
quick glimpse of relationships between different variables.

```{r Scatter plot matrix with grade, fig.height=7, fig.width=12, warning=FALSE, message=FALSE}
g <- ggpairs(subset(wine, select = -c(X, quality)),  
        lower = list(continous = wrap("points", shape = I('.'))), 
        upper = list(combo = wrap("box", outlier.shape = I('.'), size = 5)), 
        columnLabels = c("Fixed\nAcidity", "Volatile\nAcidity","Citric\nAcid", 
                         "Residual\nSugar", "Chlo-\nrides", 
                         "Free\nSulfur\nDioxide", "Total\nSulfur\nDioxide", 
                         "Density", "pH", "Sul-\nphates", "Alcohol", "Grade"), 
        axisLabels = "show")

g <- g + theme(
  axis.text = element_text(size = 5),
  axis.title = element_text(size = 5),
  legend.background = element_rect(fill = "white"),
  panel.grid.major = element_line(colour = NA),
  panel.grid.minor = element_blank(),
  panel.background = element_rect(fill = "grey95")
)

g
```

**Observation(s):**  
Citric Acid has interesting correlation with:  
1. Density (r = 0.36)  
2. Sulphates (r = 0.31)  

No further exploration of citric acid against fixed acidity and volatile 
acidity is taken, partly because of the relatively higher correlation (> 0.5). 
Due to this correlation, it stands to reason that the change in citric acid 
concentration will be accompanied by a corresponding change in those 2 
properties.

***

### Citric Acid by Grade

```{r Histogram of Citric Acid coloured by Grade}
ggplot(data = wine, aes(x = citric.acid, fill = grade)) + 
  geom_histogram(binwidth = .05) + 
  geom_vline(xintercept = median(wine$citric.acid), 
             color = "orange", 
             linetype = 2, 
             size = 1)
```


```{r Histogram of Citric Acid faceted by Grade}
plot_custom_histo(wine, "citric.acid", binw = .02) +
    facet_wrap(~ grade, nrow = 3, scales = "free_y") + 
    geom_vline(xintercept = median(wine$citric.acid), 
               color = "orange", 
               linetype = 2)
```

**Observation(s):**  
Excellent wines tend to have citric acid between 0.25 - 0.62 g/dm^3^, above 
the data set's median (dashed line) while the lower grade wines tend to have 
lower citric acid concentration. This is supported by boxplot below.

```{r Boxplot of Citric Acid and Grade}
boxplot_on_quality(wine, "citric.acid", on_grade = T) + 
  coord_cartesian(ylim = c(0, 1))

```

This resonates with me well since acidity of wine is said to be one of its most 
appealing characteristics according to [Total Wine's article on acidity & crispness](http://www.totalwine.com/wine-guide/wine-acidity-crispness).

But why then do some Excellent wines have extremely low acidity? Are there 
other chemical properties making up for this? Higher alcohol? Lower residual 
sugar? What about sulphates?

According to [Total Wine's article on balance](http://www.totalwine.com/wine-guide/wine-balance), "Wine high in 
acid should be balanced with the proper amount of residual sugar." So, the 
reverse is true - that wine low in acid should have a counter of residual 
sugar to create a balance that raises the quality of wine.

***

### Residual sugar by Grade

```{r Histogram of Residual Sugar faceted by Grade}
plot_custom_histo(wine, "residual.sugar", binw = .1) + 
  scale_x_continuous(trans = "log", 
                     limits = c(0.9, 
                           quantile(wine$residual.sugar, probs = .99)
                           )
                  ) + 
  geom_vline(xintercept = median(wine$residual.sugar), 
             color = "orange", 
             linetype = 2) + 
  facet_wrap(~ grade, nrow = 3, scales = "free_y") + 
  ggtitle("Histogram of Residual Sugar (log) faceted by Grade")
```

```{r}
summary(wine$residual.sugar)
```


**Observation(s):**  
Range bound residual sugar concentration in Normal and Excellent wine at 
1.9 - 2.7, around the median value for the data set. 


```{r Boxplot of Residual Sugar and Grade}
boxplot_on_quality(wine, "residual.sugar", on_grade = T) + 
  coord_cartesian(ylim = c(0.5, 5))

```

**Observation(s):**  
Range bound residual sugar concentration in Normal and Excellent wine at 
1.9 - 2.7, whereas Poor quality wines have wider spread of residual sugar. 

So, does residual sugar make up for low citric acid in Excellent wine?

```{r Residual Sugar over Citric Acid}
ggplot(data = subset(wine, grade == "Excellent"), 
       aes(x = citric.acid, 
           y = residual.sugar)
       ) + 
  geom_jitter()

```

**Observation(s):**  
Excellent wines do not seem to have observable variation in residual sugar 
concentration for citric acid between 0 - 0.6 g/dm^3^. Residual sugar appears 
range bound at 1.25 - 2.5 g/dm^3^. 

I can see that for citric acid concentration beyond 0.6 g/dm^3^, Excellent 
wines tend to have higher residual sugar, with levels starting out at 
2.4 g/dm^3^.

The table below supports this.

This is rather baffling. One explanation is that citric acid concentration 
of 0 - 0.6 g/dm^3^ is considered "low", and hence, is balanced with low 
residual sugar levels. High citric acid concentration starts beyond 
0.6 g/dm^3^.

This is counter-intuitive since the scatter plot shows 2 clusters of wine 
around:

1. citric acid levels of 0 - 0.18 g/dm^3^ (which can be construed as "low" or 
non-fruity)

2. citric acid levels of 0.25 - 0.6 g/dm^3^ (which can be construed as "high" 
or fruity)

```{r Average residual sugar across 3 distinct ranges}
wine_excel <- subset(wine, grade == "Excellent")[, c("citric.acid", "residual.sugar")]

wine_excel$citric_cut <- cut(wine_excel$citric.acid, 
                             breaks = c(0, .2, .6, .8), 
                             include.lowest = T, right = T)

wine_excel %>% 
  group_by(citric_cut) %>% 
  summarize(
    median_residual_sugar = median(residual.sugar), 
    mean_residual_sugar = mean(residual.sugar), 
    n = n() 
    )
```


***

### Density vs Citric Acid

What about the ratio of Density to Citric Acid? Does that influence the quality 
of wine? 

```{r Histogram of Density coloured by Grade}
ggplot(data = wine, aes(x = density, fill = grade)) + 
  geom_histogram(binwidth = .0005) + 
  geom_vline(xintercept = median(wine$density), 
             color = "orange", 
             linetype = 2, 
             size = 1)
```


```{r Histogram of Density faceted by Grade}
plot_custom_histo(wine, "density", binw = .0005) + 
  coord_cartesian(xlim = c(0.99, 1.01)) + 
  geom_vline(xintercept = median(wine$density), 
             color = "orange", 
             linetype = 2) + 
  facet_wrap(~ grade, nrow = 3, scales = "free_y")
```

**Observation(s):**  
Multi-modal (bi-modal) distribution of Density in Excellent grade wines - 
similar to the distribution observed for Citric Acid in wines.

***

### Sulphates by Grade

```{r Histogram of Sulphates coloured by Grade}
ggplot(data = wine, aes(x = sulphates, fill = grade)) + 
  geom_histogram(binwidth = .05) + 
  geom_vline(xintercept = median(wine$sulphate), 
             color = "orange", 
             linetype = 2, 
             size = 1)
```

```{r Histogram of Sulphates faceted by Grade}
plot_custom_histo(wine, "sulphates", binw = .05) + 
  coord_cartesian(xlim = c(0, 1.5)) + 
  geom_vline(xintercept = median(wine$sulphates), 
             color = "orange", 
             linetype = 2) + 
  facet_wrap(~ grade, nrow = 3, scales = "free_y")
```

```{r Histogram of Sulphates (log) faceted by Grade, warning=FALSE}
plot_custom_histo(wine, "sulphates", binw = .05) + 
  scale_x_continuous(trans = "log", 
                     limits = c(.3, 
                                quantile(wine$sulphates, probs = .99)
                                )
                     ) + 
  geom_vline(xintercept = median(wine$sulphates), 
             color = "orange", 
             linetype = 2) + 
  facet_wrap(~ grade, nrow = 3, scales = "free_y") + 
  ggtitle("Histogram of Sulphates (log) faceted by Grade")
```

**Observation(s):**  
Excellent wines have sulphates higher than the median (dashed line) in the 
dataset, suggesting that sulphates play an important role in wine quality. 
This is supported by boxplot below.

```{r Boxplot of Sulphates and Grade}
boxplot_on_quality(wine, "sulphates", on_grade = T) + 
  coord_cartesian(ylim = c(0.25, 1.25))

```


***

Let's catch another glimpse of the relationship between selected chemical 
properties, coloured by the 2 grades of wines: Poor and Excellent. 

```{r ggpairs w/o Normal, fig.height=7, fig.width=12, message=FALSE, warning=FALSE}

# Scatter plot matrix excludes:
# Normal grade wines, "pH", "quality"
ggpairs(subset(wine, grade != "Normal")[, !names(wine) %in% 
                                          c("X", 
                                            "fixed.acidity", "volatile.acidity", 
                                            "pH", "quality")], 
        ggplot2::aes(colour = grade, alpha = .1), 
        lower = list(continous = wrap("points", shape = I('.'))), 
        upper = list(combo = wrap("box", outlier.shape = I('.'), size = 1)), 
        columnLabels = c("Citric Acid", "Residual\nSugar", "Chlorides", 
                         "Free\nSulfur\nDioxide", "Total\nSulfur\nDioxide", 
                         "Density", "Sulphates", "Alcohol", "Grade"), 
        axisLabels = "show")

```

**Observation(s):**  
When Normal grade wines have been removed and the plots are coloured by grade, 
the multi-modal distribution of citric acid becomes apparent. 

The correlation for citric acid with density increased to 0.409, while 
the corresponding correlation with sulphates increased to 0.39. 

***

## Bivariate Analysis
### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

I explored "grade" by "citric.acid" following the multi-modal distribution 
discovered in univariate plot for citric acid. 

Interestingly, citric acid supposedly gives wine a fruity character. 
Excellent wines tend to have citric acid between 0.25 - 0.60 g/dm^3^, while 
the lower grade wines tend to have lower citric acid concentration.

However, there is a collection of wines with low citric acid concentration 
(0 - 0.20 g/dm^3^) that has been graded as Excellent. Perhaps to achieve that 
quality, the winemakers have infused a balance to the wines by altering the 
residual sugar concentration of the wine.

However, average sugar concentration of Excellent wines did not change between 
the range of citric acid levels of 0 - 0.6 g/dm^3^. Higher sugar concentration 
was observed for citric levels beyond 0.6 g/dm^3^.

On the other hand, density appeared to demonstrate tighter correlation with 
citric acid concentration due to the multi-modal distribution exhibited with 
Excellent wines.

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

Density is negatively correlated with alcohol (r = -0.55) and is positively 
correlated with residual sugar (r = 0.28). The fact that density is correlated 
with these two properties is mentioned in the research paper - density of wine 
is close to that of water depending on the percent of alcohol and sugar 
content.


### What was the strongest relationship you found?

The strongest relationship for citric acid is with density.


***

## Multi-variate Plots
# Density over Citric Acid by Grade

```{r Density over Citric Acid by Grade}
ggplot(data = wine,  
       aes(x = citric.acid, y = density, color = grade)) +
  geom_jitter(size = 1) + 
  coord_cartesian(xlim = c(0, quantile(wine$citric.acid, probs = .99)), 
                  ylim = c(0.99, quantile(wine$density, probs = .99))
                  ) +  
  geom_smooth(method = "lm") + 
  scale_color_brewer(type = "seq") + 
  theme_dark()
  
```

**Observation(s):**  
Excellent grade wines tend to have lower density compared to Poor and Normal 
wines across the range of citric acid concentration.

In the following exploration of density over citric acid, I have made a plot 
using a subset of Poor and Excellent grades wines. The exclusion of Normal 
grade wines in the plots provides a cleaner visual for comparing the influence 
of studied chemical properties have over wine's quality / grade. 

```{r Density over Citric Acid by Grade excluding Normal, warning=FALSE}
# Exclude Normal grade wines.
ggplot(data = subset(wine, grade != "Normal"),  
       aes(x = citric.acid, y = density, color = grade)) +
  geom_jitter(alpha = .3) + 
  geom_smooth(method = "lm") +
  xlim(NA, quantile(wine$citric.acid, probs = .99))
```

**Observation(s):**

1. Poor grade wines tend to have higher density across citric acid 
concentration while the Excellent grade wines tend to have lower density 
across the range.

2. There are 2 distinct ranges of citric acid concentration in Excellent 
wines; (low) 0 - 0.15 and (high) 0.3 - 0.55 g/dm^3^. Wines that fall between 
the 2 ranges tend to be of Poor grade.

```{r Distinct clusters of citric acid concentration in Excellent wines}
plot_custom_histo(subset(wine, grade != "Normal"), 
                  "citric.acid", 
                  binw = .05, 
                  x_scale = seq(0, 1, .1)) + 
  facet_wrap(~ grade, ncol = 1)
```

***

# Sulphates over Citric Acid by Grade

```{r Sulphates over Citric Acid by Grade}
ggplot(data = wine,  
       aes(x = citric.acid, y = sulphates, color = grade)) +
  geom_jitter(size = 1) + 
  coord_cartesian(xlim = c(0, quantile(wine$citric.acid, probs = .99)), 
                  ylim = c(min(wine$sulphates), quantile(wine$sulphates, probs = .99))
                  ) + 
  geom_smooth(method = "lm") +
  scale_color_brewer(type = "seq") +
  theme_dark()

```

**Observation(s):** 
Excellent wines tend to have higher sulphates over the entire range of citric 
acid concentration. However, it's interesting to see how Poor wines' fitted 
regression line (based on linear model) sulphates concentration appear to 
increase rapidly across citric acid range.

Similar to plots for density, Normal grade wines are excluded in plot 
below.

```{r Sulphates over Citric Acid by Grade excluding Normal, warning=FALSE}
# Filter out Normal grade wines, include smoothers.
ggplot(data = subset(wine, grade != "Normal"), 
       aes(x = citric.acid, y = sulphates, color = grade)) +
  geom_jitter(alpha = .3) + 
  geom_smooth(method = "lm") +
  xlim(NA, quantile(wine$citric.acid, probs = .99))

```


**Observation(s):**  
This plot shows a different story, in that the regression line of Poor wines 
do not have the same steep gradient as that previously plotted. By filtering 
out Normal grade wines, regression lines are confined to the more relevant 
limits representing the Poor and Excellent grades of wines.

The relationship between citric acid and sulphates concentration in 
predicting grade is inverse that of density, i.e. Excellent wines tend to have 
higher sulphates compared to Poor wines.

***

## Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

1. I explored citric acid in relation to grade. I filtered away the 
over-represented Normal grade wine since these could be a result of   
"safe" evaluations by wine graders.

2. Excellent wines have lower density but higher sulphates concentration 
compared to Poor quality wines.

3. Both density and sulphates display positive correlation with citric acid, 
albeit with moderate (density-citric) and low strength (sulphates-citric).

### Were there any interesting or surprising interactions between features?

The 2 ranges of citric acid concentration where wines were graded 
Excellent was interesting. This suggests that there are 2 distinct preferences 
for wine when it comes to "fruitiness".

------

## Final Plots and Summary

### Plot One
```{r echo=FALSE, warning=FALSE, Plot_One}
p1 <- ggplot(data = wine, aes(x = citric.acid, fill = grade)) + 
  geom_histogram(binwidth = .05, alpha = .6) + 
  geom_vline(xintercept = median(wine$citric.acid), 
             color = "orange", 
             linetype = 2, 
             size = 1) 

# Adding custom colour and x-axis aesthetics
p1 <- p1 + 
  scale_fill_brewer(type = "qual", palette = 6, 
                    name = "Quality Grades"
                    ) + 
  scale_x_continuous(limits = c(NA, quantile(wine$citric.acid, probs = .99)), 
                     breaks = seq(0, 1.0, .1)
                     )

# Adding labels
p1 <- p1 + 
  xlab(expression("Citric Acid (g / dm"^3*")")) + 
  ylab("Number of Wines") + 
  ggtitle("Concentration of Citric Acid in Red Wines")

p1
  
```

### Description One

The histogram plot of citric acid concentration in red wines illustrates 
differed from histogram plots of other chemical properties in that it has 
a multi-modal distribution. 

This plot prompted me to explore the relation of citric acid against 
wine quality (grade) further. 

The multi-modal distribution is more apparent when the plot is coloured by 
the grade of red wines; noticebly, Excellent grade wines have bi-modal 
distribution around 2 distinct citric acid concentration. 

I was curious to discover what would make red wines with low citric acid 
concentration just as desirable as those with higher citric acid concentration? 

### Plot Two
```{r echo=FALSE, warning=FALSE, Plot_Two}
p2 <- ggplot(data = subset(wine, grade != "Normal"), 
             aes(x = citric.acid, y = density, color = grade)) + 
  geom_jitter() + 
  geom_smooth(data = subset(wine, grade == "Poor"), 
              method = "lm", 
              colour = "indianred2") +
  geom_smooth(data = subset(wine, grade == "Excellent"), 
              method = "lm", 
              colour = "turquoise3") + 
  xlim(NA, quantile(wine$citric.acid, probs = .99))

# Adding labels
p2 <- p2 + 
  xlab(expression("Citric Acid (g / dm"^3*")")) + 
  ylab(expression("Density (g / cm"^3*")")) + 
  labs(colour = "Quality Grades") +
  ggtitle("Red Wines' Density over Citric Acid") 
  
         
p2
         
```

### Description Two

This plot of Density to Citric Acid shows that Excellent grade wines tend to 
cluster around 2 concentrations of Citric Acid:  
1. Low concentration of 0 - 0.15 g / dm^3^  
2. High concentration of 0.30 - 0.55 g / dm^3^

However, throughout the range of Citric Acid concentration, Density of 
Excellent wines tends to be lower than that of Poor wines. 

### Plot Three
```{r echo=FALSE, warning=FALSE, Plot_Three}
p3 <- ggplot(data = subset(wine, grade != "Normal"), 
             aes(x = citric.acid, y = sulphates, color = grade)) + 
  geom_jitter() + 
  geom_smooth(data = subset(wine, grade == "Poor"),  
              method = "lm", 
              colour = "indianred2") +
  geom_smooth(data = subset(wine, grade == "Excellent"), 
              method = "lm", 
              colour = "turquoise3")

# Adding x- and y-axis aesthetics
p3 <- p3 +
  xlim(NA, quantile(wine$citric.acid, probs = .99)) + 
  scale_y_continuous(limits = c(NA, 1.5))

# Adding labels
p3 <- p3 + 
  xlab(expression("Citric Acid (g / dm"^3*")")) + 
  ylab(expression("Potassium Sulphate (g / dm"^3*")")) + 
  labs(colour = "Quality Grades") +
  ggtitle("Red Wines' Sulphates over Citric Acid")

p3
```

### Description Three

The relationship between Sulphates and Citric Acid concentration for the 
2 grades of wine is the inverse of that between Density and Citric Acid. Here, 
Excellent wines tend to have higher Sulphates concentration across the range 
of Citric Acid compared to Poor wines.

------

## Reflection

I set out to look for chemical properties that may contribute to red wine's 
quality, using a data set comprising of 1,599 wine entries with 11 chemical 
properties. 

The quality rating of wines ranged from 3 - 8. Wines with quality ratings 
of 5 & 6 dominated the set of wine being studied. I decided that it would be 
easier to observe relationships if the range of quality score were grouped 
into 3 broader grades of Poor, Normal and Excellent.

Having looked at univariate plots of each property, I explored
citric acid concentration due to its interesting multi-modal 
distribution.

By plotting citric acid coloured by the grade of wine, I observed that 
Excellent wine has bi-modal distribution centered over low (0 - 
0.15 g/dm^3^) or high (0.30 - 0.55 g / dm^3^) citric acid concentration. I wanted 
to find out if there were other chemical properties that would make up for 
the different citric acid concentrations in order to yield high scoring wines. 
I was expecting to see that Excellent wines with low citric acid concentration 
might have notably different concentration of other chemical properties 
compared to their high citric acid counterparts.

I studied the relationship of density and sulphates with citric acid 
since a scatter plot matrix indicated correlations exist between these 
properties.

Density and sulphates in wines did not demonstrate trends that 
would compensate for low- or high citric acid concentrations in attaining 
Poor or Excellent grades. What was observed was that across the range of 
citric acid:  

1. Excellent wines have lower density compared to Poor wines;

2. Excellent wines have higher sulphates compared to Poor wines; and,

3. Both density and sulphates have positive correlation with citric acid 
in Poor as well as Excellent wines.

Citric acid is known to give wine its fruity taste. I did not observe 
any trends in 2 other chemical properties (i.e. density and sulphates) that 
compensated for the low concentration of citric acid in making a wine 
Excellent as its high citric acid counterpart.

It appears that consumers' personal preference for red wines with either low or 
high citric acid concentration (non-fruity or fruity) wines allows red wines 
with low citric acid to score as Excellent. 

Aiding with the quality of wine are the density and sulphates concentration 
- Excellent wines have lower density but higher sulphates compared to Poor 
wines. 

### Challenges & Future Work Possibilities

Trying to spot patterns in the data set was a challenge since the majority 
(over 82%) of wines was scored in the "Normal" grade, leaving less than 20% 
of wines to study for patterns contributing to Excellent and comparing that to
Poor wines.

For instance, it was difficult to discern if citric acid levels in red wine 
which influence the wine's fruitiness were range bound between 0 - 0.2 g/dm^3^ 
and 0.25 - 0.60 g/dm^3^, or might also include a 3rd range of 
0.60 - 0.80 g/dm^3^. 

For future work, I expect that performing the analysis on a data set with 
larger representations of Poor and Excellent wines will yield more compelling 
observations.
